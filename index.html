<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FTL Academy LMS - Demo Simulation</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        /* Custom styles for the theme */
        :root {
            --primary-accent: #B91C1C; /* Deep Red */
            --secondary-dark: #1F2937; /* Deep Blue/Navy */
        }
        body { font-family: 'Inter', sans-serif; background-color: #f9fafb; }
        .text-primary-accent { color: var(--primary-accent); }
        .bg-primary-accent { background-color: var(--primary-accent); }
        .text-secondary-dark { color: var(--secondary-dark); }
        .bg-secondary-dark { background-color: var(--secondary-dark); }
        .header-bg { background-image: linear-gradient(135deg, var(--secondary-dark) 0%, #111827 100%); }
        /* Add a fixed height for the content area to prevent layout shift on toggling */
        #app-root { min-height: 80vh; }
    </style>
</head>
<body class="min-h-screen antialiased">

    <!-- Instruction Banner / Role Switcher -->
    <div class="max-w-7xl mx-auto px-4 pt-4">
        <div id="role-switcher" class="bg-blue-100 p-4 rounded-xl shadow-md flex flex-wrap items-center justify-between text-sm mb-4 border border-blue-300">
            <span class="font-semibold text-blue-800">SIMULATION MODE:</span>
            <span id="current-role" class="font-bold text-lg text-primary-accent"></span>
            <div class="flex space-x-3 mt-2 md:mt-0">
                <button onclick="setRole('FTL')" class="px-3 py-1 bg-primary-accent text-white font-semibold rounded-lg hover:bg-red-700 transition">View as FTL User</button>
                <button onclick="setRole('Facilitator')" class="px-3 py-1 bg-yellow-600 text-white font-semibold rounded-lg hover:bg-yellow-700 transition">View as Facilitator</button>
                <button onclick="setRole('Admin')" class="px-3 py-1 bg-secondary-dark text-white font-semibold rounded-lg hover:bg-gray-700 transition">View as Admin</button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="header-bg text-white p-6 md:p-8 shadow-2xl">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center">
                <img src="https://s3-eu-central-1.amazonaws.com/com-recruiterflow-static-content-eu/careers-page/prod/db_f3b9b145d83e14c6cda95cbb821f78b5/IMG_2842.jpeg" 
                     alt="The Veteran Alliance Bank Logo" 
                     class="h-10 mr-4 rounded-lg shadow-md" />
                <div>
                    <h1 class="text-2xl font-extrabold tracking-widest text-gray-200">FTL ACADEMY LMS</h1>
                    <p class="text-sm font-light text-primary-accent">The Veteran Alliance Bank</p>
                </div>
            </div>
            <span id="role-tag" class="text-sm font-semibold p-2 bg-primary-accent rounded-lg"></span>
        </div>
    </header>

    <!-- Main Content Root -->
    <main id="app-root" class="max-w-7xl mx-auto">
        <!-- Dashboard content will be rendered here by JavaScript -->
    </main>

    <script>
        // --- Full FTL Academy Curriculum Data (Detailed for Facilitation) ---
        // NOTE: The curriculum is updated to reflect the 4-hour schedule (0900-1300) and the new Day 6, 7, 10 content.
        const FTL_CURRICULUM = {
            1: [
                { id: '1A', day: 1, session: 'Morning', title: 'Leadership Foundations & The Strategic Mindset', 
                    concepts: ['The shift from "Doer" to **"Orchestrator."**', 'Understanding the "Why" (system rationale) over the "What" (task execution).', 'Principles of remote leadership (Over-communication, digital presence).'],
                    activity: { name: 'Role-Play: The Sherpa Mindset', details: 'FTLs practice guiding a subordinate through a problem without giving the answer, focusing on powerful, open-ended questions.' },
                    facilitator: '[Time: 10 min] **Welcome & Icebreaker.** [Time: 45 min] **Session 1: Mindset Shift & Core Rules:** Define the FTL Oath (No Drama, No Bullshit). [Time: 75 min] **Session 2: Remote Leadership & Coaching:** Debrief challenges. **Prompt:** "How does your digital footprint reflect the standards you expect?" Run the Sherpa Mindset role-play. [Time: 90 min] **Session 3: System Mapping & Financial Literacy:** Map the Member Journey and discuss the VAB mission (helping veterans become millionaires).'
                },
                { id: '2A', day: 2, session: 'Morning', title: 'Processor & Underwriter Perspectives (Mortgage)', 
                    concepts: ['Processor workflow & prioritization in the LOS (Brightly).', 'Mandatory **LOS Input Rules** (data integrity for AUS).', 'Credit Risk Scoring: Reading a credit report beyond the FICO score (derogatory credit history).'],
                    activity: { name: 'Hands-On: The Flawless File Review', details: 'Review sample loan packages (redacted) and flag 5 common errors that trigger a Processor Suspension and an Underwriter condition.' },
                    facilitator: '[Time: 90 min] **Session 1: Processor Guest Speaker.** Focus on the *cost* (time/member trust) of bad data input and "Red Flags." [Time: 15 min] **Break.** [Time: 105 min] **Session 2: Underwriter Guest Speaker.** Focus on **risk vs. sales** and the 3 C\'s. Challenge FTLs on their risk decisions. [Time: 30 min] **Session 3: Workshop:** Run the Flawless File Review and Credit Analysis Workshop concurrently. FTLs must identify errors and propose a compliant Letter of Explanation (LOX).'
                },
                { id: '3A', day: 3, session: 'Morning', title: 'VA Loans, Specialty Products & Closing Process', 
                    concepts: ['VA/FHA Guideline Overlays (VAB specific).', 'Certificate of Eligibility (COE) and entitlement restoration.', 'The Closer’s View: Understanding and curing **Tolerance Violations (TRID)**.'],
                    activity: { name: 'CD Deep Dive & VA Case Study', details: 'FTLs review a sample Loan Estimate vs. Closing Disclosure and identify where a tolerance cure would be necessary. Solve a scenario involving a surviving spouse and a joint VA loan.' },
                    facilitator: '[Time: 90 min] **Session 1: VA Loan Specialist Guest Speaker.** Focus on complex entitlement scenarios and MPRs/CRVs. [Time: 15 min] **Break.** [Time: 60 min] **Session 2: Specialty Products:** Review FHA/Conventional overlays and Construction loan draw schedules. [Time: 75 min] **Session 3: Closer Guest Speaker:** Emphasize that the FTL\'s job is to prepare the member and anticipate title issues *before* the CD is sent. Run the CD Deep Dive & VA Case Study.'
                },
                { id: '4A', day: 4, session: 'Morning', title: 'Advanced Insurance & Member Wealth Building', 
                    concepts: ['Carrier’s Perspective: Medical underwriting, MIB reports, and risk classification.', 'IUL & VetLife Program: Cash value access strategies, policy loan mechanics, and **tax-advantaged growth**.', 'P&C Underwriting: Credit-based insurance scores and Umbrella Policies.'],
                    activity: { name: 'Case Study: Life & Retirement Plan Design', details: 'Design a comprehensive life insurance and retirement plan (including IUL) for a sample member, focusing on the **generational wealth** component.' },
                    facilitator: '[Time: 105 min] **Session 1: Life Underwriter Guest Speaker.** Focus on how the FTL teaches their team to integrate life insurance as a financial pillar. **Lecture:** IUL mechanics, illustrations, and wealth transfer. [Time: 15 min] **Break.** [Time: 120 min] **Session 2 & 3: P&C Underwriter Guest Speaker & Workshop.** P&C underwriting, risk coordination, and run the Case Study: Life & Retirement Plan Design. Stress teaching teams to explain IUL as a wealth tool.'
                },
                { id: '5A', day: 5, session: 'Morning', title: 'Banking Operations, Compliance & Risk Management', 
                    concepts: ['Core System Transaction Codes & KYC/CIP requirements.', '**BSA/AML Compliance (CTR/SAR)** Thresholds and reporting obligations.', 'Regulation E (EFT) dispute protocols and GLBA privacy requirements.', 'Credit building strategies to teach members (Credit Optimization).'],
                    activity: { name: 'Compliance Scenario Application', details: 'FTLs review 3 scenarios involving suspicious activity (money laundering, wire fraud) and determine the appropriate reporting, compliance, and member education steps.' },
                    facilitator: '[Time: 105 min] **Session 1: Banking Ops & Compliance Officer Guests.** Focus on fraud detection, BSA/AML, and TILA/Reg E. [Time: 15 min] **Break.** [Time: 120 min] **Session 2 & 3: Workshop.** Run the Compliance Scenario Application. FTLs must identify the *exact regulatory obligation* and develop a "Banking 101" member education presentation.'
                },
            ],
            2: [
                { id: '6A', day: 6, session: 'Morning', title: 'LEGAL & REGULATORY COMPLIANCE FOR LEADERS', 
                    concepts: ['RESPA, TILA, ECOA, and FCRA requirements.', 'The SAFE Act and licensing obligations.', 'Fair lending and disparate impact (Redlining/Steering).', 'Marketing compliance: TCPA, CAN-SPAM, and record retention.'],
                    activity: { name: 'Compliance Risk Audit Simulation', details: 'FTLs review mock marketing materials and team communication transcripts to identify 5 critical compliance violations that require immediate escalation.' },
                    facilitator: '[Time: 120 min] **Session 1: Legal Counsel Guest Speaker.** Overview of RESPA/TILA/ECOA. Focus on the cost of non-compliance. [Time: 15 min] **Break.** [Time: 105 min] **Session 2: Chief Compliance Officer Guest Speaker & Workshop.** Focus on creating a culture of compliance, audit preparedness, and running the Compliance Risk Audit Simulation.'
                },
                { id: '7A', day: 7, session: 'Morning', title: 'HR ESSENTIALS FOR FIRE TEAM LEADERS', 
                    concepts: ['Employment Law Basics: At-will, Protected Classes (Title VII, ADA, GINA).', 'Harassment and hostile work environment (Prevention & Reporting).', 'Progressive Discipline: Verbal, Written, Final Warning (objective documentation).', 'FMLA and USERRA protections for service members.'],
                    activity: { name: 'Documentation & PIP Workshop', details: 'FTLs draft documentation for a poor performance scenario and create a clear, measurable Performance Improvement Plan (PIP).' },
                    facilitator: '[Time: 120 min] **Session 1: HR Director Guest Speaker.** Focus on the legal pitfalls of leadership (documentation, discrimination). [Time: 15 min] **Break.** [Time: 105 min] **Session 2: HR Business Partner Guest Speaker & Workshop.** Focus on performance management documentation. Run the Documentation & PIP Workshop. Stress: "If it\'s not documented, it didn\'t happen."'
                },
                { id: '8A', day: 8, session: 'Morning', title: 'MASTERING PROCESS, PIPELINE & TEAM COORDINATION', 
                    concepts: ['Quality Control (QC) standards and **Audit Trail Requirements**.', 'Pipeline Management: Velocity Metrics and bottleneck identification.', 'Creating **System Feedback Loops** with Operations to improve team quality.', 'Leveraging CRM/LOS for team efficiency.'],
                    activity: { name: 'Workshop: SOP & Dashboard Template', details: 'FTLs create a draft Standard Operating Procedure (SOP) for new file submission and a simple Pipeline Velocity Dashboard template.' },
                    facilitator: '[Time: 90 min] **Session 1: Process Deep Dive (Universal).** Focus on how to structure a process that is both fast and compliant. [Time: 15 min] **Break.** [Time: 135 min] **Session 2 & 3: Workshop & Systems.** Run the SOP/Dashboard Workshop. FTLs must leave with a plan to implement these tools immediately. Review CRM/LOS best practices and training techniques.'
                },
                { id: '9A', day: 9, session: 'Morning', title: 'LEADERSHIP SKILLS - COACHING, PERFORMANCE & COMMUNICATION', 
                    concepts: ['The **GROW Model** (Goal, Reality, Options, Will) for structured coaching.', 'Setting SMART goals and production/activity metrics.', 'Communication Mastery: Running effective one-on-ones, huddles, and conflict resolution.'],
                    activity: { name: 'Advanced Role-Play: GROW Model & Difficult Conversation', details: 'Practice using the GROW model with a team member struggling with complex product knowledge and deliver a tough accountability message.' },
                    facilitator: '[Time: 90 min] **Session 1: Workshop.** Introduce and practice the GROW model. [Time: 15 min] **Break.** [Time: 75 min] **Session 2: Performance & Accountability.** Lecture on SMART goals and addressing performance issues. [Time: 80 min] **Session 3: Communication Mastery.** Run the Advanced Role-Play. Focus on professional language and maintaining composure ("Never complaining in public").'
                },
                { id: '10A', day: 10, session: 'Morning', title: 'FINANCIAL LITERACY, WEALTH GENERATION & GRADUATION', 
                    concepts: ['Financial Literacy as a Member Service Tool (VAB mission).', 'Teaching members about budgeting, credit optimization, and debt payoff strategies.', 'Investment Education: Diversification, compound interest, and supporting veteran entrepreneurs.', 'Final Assessment & Leadership Vision.'],
                    activity: { name: 'Master Case Study & Leadership Presentation', details: 'FTLs solve a 5-product financial scenario, integrating member education and present their Personal Leadership Philosophy and 30-60-90 Day Plan.' },
                    facilitator: '[Time: 120 min] **Session 1: Guest Speaker (Financial Advisor).** Focus on the VAB mission and creating generational wealth. Emphasize how FTLs train their teams to be educators, not just salespeople. [Time: 15 min] **Break.** [Time: 60 min] **Session 2: Final Exam & Case Study.** [Time: 75 min] **Session 3: Presentations & Graduation.** Conduct final FTL presentations and the graduation ceremony, reinforcing the leadership commitment.'
                }
            ]
        };
        const ALL_SESSIONS = [...FTL_CURRICULUM[1], ...FTL_CURRICULUM[2]];
        const TOTAL_SESSIONS = ALL_SESSIONS.length;

        // --- Mock Data for Simulation ---
        const MOCK_FTL_PROGRESS = {
            '1A': true, '2A': true, '3A': true, '4A': false, '5A': false,
            '6A': false, '7A': false, '8A': false, '9A': false, '10A': false,
        };
        
        const MOCK_ADMIN_DATA = {
            'FTL-Alpha-723': { progress: { ...MOCK_FTL_PROGRESS }, userId: 'FTL-Alpha-723', name: 'Commander Alpha', role: 'FTL' }, // 30%
            'FTL-Bravo-001': { progress: { '1A': true, '2A': true, '3A': true, '4A': true, '5A': true, '6A': false, '7A': false, '8A': false, '9A': false, '10A': false }, userId: 'FTL-Bravo-001', name: 'Lt. Bravo', role: 'FTL' }, // 50%
            'FTL-Charlie-989': { progress: { ...Object.fromEntries(ALL_SESSIONS.map(s => [s.id, true])) }, userId: 'FTL-Charlie-989', name: 'Capt. Charlie', role: 'FTL' }, // 100%
            'FTL-Delta-444': { progress: { '1A': true }, userId: 'FTL-Delta-444', name: 'Sgt. Delta', role: 'FTL' }, // 10%
        };
        
        // --- State Management ---
        let currentRole = 'FTL';
        let currentMockProgress = { ...MOCK_FTL_PROGRESS };
        let activeWeek = 1;
        let expandedSession = null;

        // --- Core Quiz Simulation Functions ---
        window.startQuiz = (sessionId) => {
            // A simple simulation: 80% chance of passing
            const passed = Math.random() > 0.2; 

            if (passed) {
                currentMockProgress[sessionId] = true;
                alert('Quiz Passed! Module marked complete.');
                renderDashboard();
            } else {
                alert('Quiz Failed. Please review the material and try again.');
            }
        };

        // --- Component Rendering Functions (Simplified for HTML Demo) ---

        const renderCourseDetail = (sessionData, userProgress) => {
            const isCompleted = userProgress[sessionData.id] || false;
            const isFacilitator = currentRole === 'Facilitator';

            const activityHtml = sessionData.activity ? `
                <div class="bg-blue-50 p-3 rounded-md border border-blue-200">
                    <p class="font-semibold text-blue-700 flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                        ACTIVITY: ${sessionData.activity.name || 'Workshop'}
                    </p>
                    <p class="text-gray-700 text-sm mt-1">${sessionData.activity.details || ''}</p>
                </div>` : '';

            const quizButton = isCompleted
                ? '<button class="px-4 py-1 text-sm font-semibold rounded-full bg-green-600 text-white cursor-default">Completed</button>'
                : `<button onclick="startQuiz('${sessionData.id}')" class="px-4 py-1 text-sm font-semibold rounded-full bg-primary-accent text-white hover:bg-red-700 transition">Start Quiz (Simulated)</button>`;

            const facilitatorScript = `
                <div class="border-l-4 border-yellow-500 pl-3 bg-yellow-50 p-3 rounded-md">
                    <p class="font-bold text-yellow-700">FACILITATOR TEACHING SCRIPT:</p>
                    <p class="text-gray-700 text-sm italic">${sessionData.facilitator}</p>
                    <p class="mt-2 font-bold text-yellow-700">DISCUSSION PROMPT:</p>
                    <p class="text-gray-700 text-sm italic">"Based on the underwriter\'s risk model, what is the single biggest factor that can cause a deal to be suspended at **The Veteran Alliance Bank**?"</p>
                </div>
            `;
            
            return `
                <div class="p-4 bg-white rounded-lg shadow-inner border border-gray-200 mt-4">
                    <div class="flex justify-between items-start mb-3 border-b pb-2">
                        <h4 class="text-xl font-bold text-secondary-dark">${sessionData.title}</h4>
                        ${isFacilitator ? '' : quizButton}
                    </div>
                    
                    <div class="space-y-4">
                        ${isFacilitator ? facilitatorScript : ''}

                        <div>
                            <p class="font-semibold text-secondary-dark mb-1 flex items-center">
                                <svg class="w-4 h-4 mr-2 text-primary-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944c-1.57.065-3.136.315-4.66.757-1.523.441-2.996 1.054-4.38 1.838a1 1 0 00-.318.89l.348 2.088a1 1 0 00.56.787l3.86 2.012a1 1 0 00.992-.124l4.288-3.92a1 1 0 00-.73-1.68zM12 21a9 9 0 006.128-2.316l-.286-1.536a1 1 0 00-.518-.687L12 17a1 1 0 00-.97-.56l-3.21-1.07a1 1 0 00-.712.597l-1.42 2.84a1 1 0 00.32 1.094A9.001 9.001 0 0012 21z"/></svg>
                                CORE CONCEPTS (Student Learning Objectives):
                            </p>
                            <ul class="list-disc list-inside ml-4 space-y-1 text-gray-600">
                                ${sessionData.concepts.map(c => `<li class="text-sm">${c}</li>`).join('')}
                            </ul>
                        </div>
                        ${activityHtml}
                    </div>
                </div>
            `;
        };

        const renderCurriculum = (userId) => {
            return `
                <div class="p-4 md:p-8">
                    <h2 class="text-3xl font-bold text-secondary-dark mb-4">FTL Academy Curriculum</h2>
                    
                    <div class="flex border-b mb-6 schedule-scroll overflow-x-auto bg-white rounded-t-xl shadow-inner">
                        <button onclick="setActiveWeek(1)" class="p-3 text-sm font-medium border-b-2 transition duration-150 ${activeWeek === 1 ? 'border-primary-accent text-primary-accent' : 'border-transparent text-gray-500 hover:text-primary-accent'}">
                            WEEK 1: Mortgage & Operational Mastery
                        </button>
                        <button onclick="setActiveWeek(2)" class="p-3 text-sm font-medium border-b-2 transition duration-150 ${activeWeek === 2 ? 'border-primary-accent text-primary-accent' : 'border-transparent text-gray-500 hover:text-primary-accent'}">
                            WEEK 2: Legal, HR, Commercial & Leadership Execution
                        </button>
                    </div>

                    <div id="curriculum-content" class="space-y-4">
                        ${FTL_CURRICULUM[activeWeek].map((session) => `
                            <div class="bg-white rounded-xl shadow-lg overflow-hidden border-t-4 border-secondary-dark">
                                <div 
                                    class="p-4 cursor-pointer flex justify-between items-center hover:bg-gray-50"
                                    onclick="toggleSession('${session.id}')"
                                >
                                    <div>
                                        <p class="text-xs font-semibold uppercase tracking-wider text-primary-accent">Day ${session.day} - ${session.session}</p>
                                        <h3 class="text-lg font-bold text-secondary-dark">${session.title}</h3>
                                    </div>
                                    <div class="flex items-center space-x-3">
                                        <span class="w-3 h-3 rounded-full ${currentMockProgress[session.id] ? 'bg-green-600' : 'bg-gray-400'}" title="${currentMockProgress[session.id] ? 'Completed' : 'Incomplete'}"></span>
                                        <svg class="w-5 h-5 text-gray-600 transition-transform ${expandedSession === session.id ? 'rotate-180' : ''}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7" /></svg>
                                    </div>
                                </div>
                                ${expandedSession === session.id ? `
                                    <div class="p-4 border-t border-gray-200">
                                        ${renderCourseDetail(session, currentMockProgress)}
                                    </div>
                                ` : ''}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        };

        const renderFTLDashboard = (userId) => {
            const completedSessions = Object.values(currentMockProgress).filter(v => v).length;
            const progressPercentage = Math.round((completedSessions / TOTAL_SESSIONS) * 100) || 0;

            const FTL_HTML = `
                <div class="p-4 md:p-8">
                    <h2 class="text-3xl font-bold text-secondary-dark mb-4">FTL Academy Progress Dashboard</h2>
                    
                    <div class="bg-white p-4 rounded-xl shadow-lg mb-6 border-l-4 border-primary-accent">
                        <p class="text-sm text-gray-600 mb-2">FTL ID: <span class="font-mono text-xs text-primary-accent">${userId}</span></p>
                        <p class="text-xl font-semibold text-secondary-dark mb-2">Overall Progress: ${completedSessions} of ${TOTAL_SESSIONS} Modules</p>
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div 
                                class="bg-primary-accent h-3 rounded-full transition-all duration-500" 
                                style="width: ${progressPercentage}%"
                            ></div>
                        </div>
                        <p class="text-right text-sm font-medium text-primary-accent mt-1">${progressPercentage}% Complete</p>
                    </div>

                    ${renderCurriculum(userId)}
                </div>
            `;
            return FTL_HTML;
        };
        
        const renderFacilitatorDashboard = (userId) => {
            const FTL_KEYS = Object.keys(MOCK_ADMIN_DATA).filter(k => MOCK_ADMIN_DATA[k].role === 'FTL');

            const FACILITATOR_HTML = `
                <div class="p-4 md:p-8">
                    <h2 class="text-3xl font-bold text-secondary-dark mb-4">Facilitator Teaching Console</h2>
                    <div class="bg-yellow-50 p-4 rounded-xl shadow-lg mb-6 border-l-4 border-yellow-500">
                        <p class="font-semibold text-yellow-800">INSTRUCTOR MODE:</p>
                        <p class="text-sm text-yellow-700">Expanding any session below will display the **Full Facilitator Teaching Script** and timing notes for instructional delivery.</p>
                    </div>

                    <h3 class="text-xl font-bold text-secondary-dark mb-3">Live Group Progress Check</h3>
                    <div class="bg-white rounded-xl shadow-lg p-4 mb-8">
                        <ul class="space-y-2">
                            ${FTL_KEYS.map(key => {
                                const data = MOCK_ADMIN_DATA[key];
                                const completed = Object.values(data.progress || {}).filter(v => v).length;
                                const percentage = Math.round((completed / TOTAL_SESSIONS) * 100) || 0;
                                return `
                                    <li class="flex items-center justify-between border-b pb-2">
                                        <span class="font-semibold text-secondary-dark">${data.name}</span>
                                        <span class="text-sm">${completed} / ${TOTAL_SESSIONS} Modules (${percentage}%)</span>
                                    </li>
                                `;
                            }).join('')}
                        </ul>
                    </div>

                    ${renderCurriculum(userId)}
                </div>
            `;
            return FACILITATOR_HTML;
        };


        const renderAdminDashboard = () => {
            const FTL_KEYS = Object.keys(MOCK_ADMIN_DATA).filter(k => MOCK_ADMIN_DATA[k].role === 'FTL');

            const ADMIN_HTML = `
                <div class="p-4 md:p-8">
                    <h2 class="text-3xl font-bold text-secondary-dark mb-6">Admin Progress Tracking Console</h2>
                    
                    <div class="overflow-x-auto bg-white rounded-xl shadow-lg">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-secondary-dark text-white">
                                <tr>
                                    <th class="px-3 py-3 text-left text-xs font-semibold uppercase tracking-wider">FTL NAME</th>
                                    <th class="px-3 py-3 text-left text-xs font-semibold uppercase tracking-wider">Progress</th>
                                    ${ALL_SESSIONS.map(session => `
                                        <th key="${session.id}" class="px-2 py-3 text-center text-xs font-semibold uppercase tracking-wider">
                                            ${session.id}
                                            <span class="block font-normal text-gray-300 text-[10px] whitespace-nowrap">Day ${session.day}</span>
                                        </th>
                                    `).join('')}
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                ${FTL_KEYS.map(userId => {
                                    const data = MOCK_ADMIN_DATA[userId];
                                    const completed = Object.values(data.progress || {}).filter(v => v).length;
                                    const percentage = Math.round((completed / TOTAL_SESSIONS) * 100) || 0;
                                    return `
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-3 py-4 whitespace-nowrap text-sm font-medium text-secondary-dark">${data.name}</td>
                                            <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <div class="w-20 bg-gray-200 rounded-full h-2">
                                                    <div class="bg-primary-accent h-2 rounded-full" style="width: ${percentage}%"></div>
                                                </div>
                                                <span class="text-xs">${percentage}%</span>
                                            </td>
                                            ${ALL_SESSIONS.map(session => `
                                                <td class="px-2 py-4 whitespace-nowrap text-center">
                                                    <span class="w-4 h-4 inline-block rounded-full ${data.progress?.[session.id] ? 'bg-green-500' : 'bg-red-400'}" title="${data.progress?.[session.id] ? 'Complete' : 'Incomplete'}"></span>
                                                </td>
                                            `).join('')}
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            return ADMIN_HTML;
        };

        // --- Controller Logic ---
        
        window.setActiveWeek = (week) => {
            activeWeek = week;
            renderDashboard();
        };

        window.toggleSession = (id) => {
            expandedSession = expandedSession === id ? null : id;
            renderDashboard();
        };

        window.setRole = (role) => {
            currentRole = role;
            renderDashboard();
        };

        const renderDashboard = () => {
            const root = document.getElementById('app-root');
            const roleTag = document.getElementById('role-tag');
            const currentRoleText = document.getElementById('current-role');
            
            if (!root || !roleTag || !currentRoleText) return;

            let contentHTML = '';
            let tagClass = '';
            let tagText = '';

            switch(currentRole) {
                case 'Admin':
                    contentHTML = renderAdminDashboard();
                    tagText = 'ADMIN CONSOLE';
                    tagClass = 'bg-secondary-dark';
                    break;
                case 'Facilitator':
                    contentHTML = renderFacilitatorDashboard('Facilitator-Lead');
                    tagText = 'FACILITATOR VIEW';
                    tagClass = 'bg-yellow-600';
                    break;
                case 'FTL':
                default:
                    // If switching roles, use a mock FTL's progress data for consistent testing
                    currentMockProgress = { ...MOCK_ADMIN_DATA['FTL-Alpha-723'].progress };
                    contentHTML = renderFTLDashboard('FTL-Alpha-723');
                    tagText = 'FTL USER';
                    tagClass = 'bg-primary-accent';
                    break;
            }

            root.innerHTML = contentHTML;
            roleTag.textContent = tagText;
            roleTag.className = `text-sm font-semibold p-2 rounded-lg ${tagClass}`;
            currentRoleText.textContent = tagText;
        };

        // Initial render
        document.addEventListener('DOMContentLoaded', () => {
            renderDashboard();
        });
    </script>
</body>
</html>

